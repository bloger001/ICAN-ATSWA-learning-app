<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <title>ICAN Prep Journey</title>
  <link rel="stylesheet" href="./assets/app.css?v=17"/>
  <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate"/>
  <meta http-equiv="Pragma" content="no-cache"/>
  <meta http-equiv="Expires" content="0"/>
</head>
<body>
  <div class="wrap">
    <header>
      <h1>ICAN Prep Journey</h1>
      <p class="muted">Your path from ATSWA to Final — study smart, pass with confidence.</p>
    </header>

    <!-- Auth panel -->
    <section class="card" id="authCard">
      <div id="authArea">
        <button id="loginBtn" class="btn primary">Continue with Google</button>
      </div>
    </section>

    <!-- Tiles (dashboard) -->
    <section class="tiles" style="margin-top:20px">

      <a class="tile" href="./resources.html">
        <div class="muted small">Study</div>
        <div>Resources</div>
      </a>

      <a class="tile" href="./status.html?v=17">
        <div class="muted small">Progress</div>
        <div>Status</div>
      </a>

      <a class="tile" href="./leaderbored.html?v=17">
        <div class="muted small">Community</div>
        <div>Leaderboard</div>
      </a>

      <a class="tile" href="./admin.html">
        <div class="muted small">Admin</div>
        <div>Dashboard</div>
      </a>

    </section>

    <footer style="margin-top:40px">
      <p class="muted small">
        Built by your fellow accounting students for practice —
        created by <b>Silva Brutus</b>, student of <b>NSUK</b>.<br/>
        Contact: <a href="mailto:offixcialbloger@gmail.com">offixcialbloger@gmail.com</a>
      </p>
    </footer>
  </div>

  <!-- Firebase + auth -->
  <script type="module">
    import { auth } from './assets/firebase.js';
    import {
      GoogleAuthProvider, signInWithPopup, onAuthStateChanged, signOut
    } from "https://www.gstatic.com/firebasejs/10.13.2/firebase-auth.js";

    const authArea = document.getElementById('authArea');

    function renderSignedOut(){
      authArea.innerHTML = `<button id="loginBtn" class="btn primary">Continue with Google</button>`;
      document.getElementById('loginBtn').onclick = async ()=>{
        const provider = new GoogleAuthProvider();
        try {
          await signInWithPopup(auth, provider);
        } catch(e){ alert('Login failed: '+e.message); }
      };
    }

    function renderSignedIn(user){
      authArea.innerHTML = `
        <div class="row space-between" style="align-items:center">
          <div>
            <p><b>${user.displayName || user.email}</b></p>
            <p class="muted small">${user.email}</p>
          </div>
          <button id="logoutBtn" class="btn">Sign out</button>
        </div>
      `;
      document.getElementById('logoutBtn').onclick = ()=> signOut(auth);
    }

    onAuthStateChanged(auth, (user)=>{
      if (user) renderSignedIn(user);
      else renderSignedOut();
    });
  </script>
</body>
</html>